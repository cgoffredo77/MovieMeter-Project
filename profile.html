<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Movie Meter</title>
    <link rel="stylesheet" href="profile.css"> <!-- Link to the CSS file -->
</head>
<body>
    <h1>User Profile</h1>
    
    <div class="topnav">
        <div>
            <a href="homePage.html">Home</a>
            <a href="#about">About</a>
        </div>
        <button class="logout-button" onclick="logout()">Logout</button>
    </div>

    <div id="profileContainer">
        <!-- User profile information will be displayed here -->
        <p id="welcomeMessage"></p> <!-- Welcome message will be displayed here -->
        <h2>Your Favorite Movies</h2>
        <div id="favoriteMovies"></div> <!-- Display favorite movies here -->
    </div>

    <script>

        function createStarRating(rating) {
            const starContainer = document.createElement("div");
            starContainer.classList.add("star-rating");

            // Create 5 stars
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement("span");
                star.classList.add("star");

                // Fill star if the current rating is equal or higher
                if (i <= rating) {
                    star.textContent = "★"; // Filled star (use Unicode star)
                    star.classList.add("filled");
                } else {
                    star.textContent = "☆"; // Empty star
                }
                starContainer.appendChild(star);
            }
            return starContainer;
        }

        const BIN_ID = '67056e6aacd3cb34a89381d3'; // Replace with your actual Bin ID
        const MASTER_KEY = '$2a$10$qPie9WKKqWYtoMxhQpLEfeVOf.dI4K750AzEo7MrAWgzb2d0Cpe6m'; // Replace with your actual Master Key if required

        // Function to fetch user data from JSON Bin
        function fetchUserData() {
            return fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': MASTER_KEY // Include Master Key for authentication
                }
            })
            .then(response => response.json())
            .catch(error => console.error('Error fetching user data:', error));
        }

        // Get logged-in user from localStorage
        const loggedInUser = JSON.parse(localStorage.getItem('signedInUser')); // Ensure we're using the right key

        // Check if the user is logged in
        if (loggedInUser) {
            // Display welcome message
            document.getElementById('welcomeMessage').textContent = `Welcome, ${loggedInUser.firstName}!`; // Update to firstName

            // Call function to display favorite movies
            displayFavoriteMovies(); // Call the function to display favorite movies
        } else {
            document.getElementById('welcomeMessage').textContent = "Welcome! Please log in."; // Message if not logged in
        }

        // Function to logout
        function logout() {
            localStorage.removeItem('signedInUser'); // Remove user info from localStorage
            window.location.href = 'login.html'; // Redirect to login page
        }

        // Function to display favorite movies
        function displayFavoriteMovies() {
            fetchUserData().then(data => {
                const users = data.record.users; // Access the users array
                const user = users.find(u => u.username === loggedInUser.username); // Find the logged-in user

                if (user && user.movies.length > 0) {
                    const favoriteMoviesDiv = document.getElementById('favoriteMovies');
                    favoriteMoviesDiv.innerHTML = ''; // Clear previous content

                    user.movies.forEach(movie => {
                        // Create a container for each movie
                        const movieContainer = document.createElement('div');
                        movieContainer.classList.add('movie');

                        // Create an image element for the poster
                        const moviePoster = document.createElement('img');
                        moviePoster.src = movie.poster;
                        moviePoster.alt = `${movie.title} poster`;
                        movieContainer.appendChild(moviePoster);

                        // Create a title element for the movie title
                        const movieTitle = document.createElement('h3');
                        movieTitle.textContent = movie.title;
                        movieContainer.appendChild(movieTitle);

                        const starRating = createStarRating(movie.rating);
                        movieContainer.appendChild(starRating);

                        // Create a paragraph element for the movie overview
                        const movieOverview = document.createElement('p');
                        movieOverview.textContent = movie.overview;
                        movieContainer.appendChild(movieOverview);

                        // Append the movie container to the favoriteMovies div
                        favoriteMoviesDiv.appendChild(movieContainer);
                    });
                } else {
                    document.getElementById('favoriteMovies').textContent = 'No favorite movies found.';
                }
            });
        }


    </script>

</body>
</html>
